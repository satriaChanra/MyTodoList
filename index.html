<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List dengan Login</title>
    <script src="https://unpkg.com/vue@3"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- SweetAlert2 -->
    <style>
        footer{
            margin-top: 115px;
            width: 100%;
            text-align: center;
            line-height: 35px;
            height: 35px;
            /* background-color: skyblue; */
        }
        body {
            background-color: #f8f9fa;
        }
        h2 {
            color: #007bff;
            font-family: 'Arial', sans-serif;
            font-weight: bold;
            font-size: 32px;
        }
        h4 {
            color: #343a40;
            font-family: 'Arial', sans-serif;
            font-weight: bold;
            font-size: 24px;
        }
        .btn-primary {
            background-color: #007bff;
            border: none;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
        /* Responsiveness */
        @media (max-width: 576px) {
            h2 {
                font-size: 28px;
            }
            h4 {
                font-size: 20px;
            }
            .form-control {
                font-size: 14px;
            }
            .btn {
                font-size: 14px;
            }
            .container {
                padding-left: 15px;
                padding-right: 15px;
            }
            .col-9 {
                flex: 0 0 auto;
                width: 100%;
            }
            .col-7 {
                flex: 0 0 auto;
                width: 100%;
            }
            .p-3 {
                padding: 12px;
            }
        }

        .fade-enter-active, .fade-leave-active {
            transition: all 0.5s ease;
        }
        .fade-enter, .fade-leave-to {
            opacity: 0;
            transform: translateY(-20px);
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <!-- Halaman Login -->
            <div v-if="currentPage === 'login' && !isLoggedIn" class="d-flex flex-column align-items-center justify-content-center" style="min-height: 100vh;">
                <h2 class="text-center">Login</h2>
                <div class="mt-4" style="width: 100%; max-width: 400px;">
                    <input v-model="loginUsername" class="form-control mb-3" placeholder="Username" type="text">
                    <input v-model="loginId" class="form-control mb-3" placeholder="ID" type="number" min="10000"> <!-- Type number -->
                    <button @click="login" class="btn btn-primary w-100" :disabled="loginId.toString().length < 5">Login</button> <!-- Tombol dinonaktifkan jika ID kurang dari 5 digit -->
                    <button @click="switchPage('register')" class="btn btn-secondary w-100 mt-3">Buat Akun</button>
                </div>
            </div>

            <!-- Halaman Register -->
            <div v-if="currentPage === 'register' && !isLoggedIn" class="d-flex flex-column align-items-center justify-content-center" style="min-height: 100vh;">
                <h2 class="text-center">Buat Akun</h2>
                <div class="mt-4" style="width: 100%; max-width: 400px;">
                    <input v-model="registerUsername" class="form-control mb-3" placeholder="Username" type="text">
                    <input v-model="registerId" class="form-control mb-3" placeholder="ID (Minimal 5 Digit)" type="number" min="10000"> <!-- Type number -->
                    <button @click="register" class="btn btn-primary w-100" :disabled="registerId.toString().length < 5">Buat Akun</button> <!-- Tombol dinonaktifkan jika ID kurang dari 5 digit -->
                    <button @click="switchPage('login')" class="btn btn-secondary w-100 mt-3">Kembali ke Login</button>
                </div>
            </div>

            <!-- Halaman Todo List jika sudah login -->
            <div v-if="isLoggedIn">
                <h2 class="mt-5 text-center">Todo List - {{ currentUser.username }}</h2>

                <div class="row justify-content-center">
                    <div class="col-9 mt-4">
                        <div class="row">
                            <!-- Input waktu mulai -->
                            <div class="col-2">
                                <select v-model="startTime" class="form-control">
                                    <option disabled value="">Start time</option>
                                    <option v-for="time in timeOptions" :key="time" :value="time">{{ time }}</option>
                                </select>
                            </div>

                            <!-- Input waktu akhir -->
                            <div class="col-2">
                                <select v-model="endTime" class="form-control">
                                    <option disabled value="">End time</option>
                                    <option v-for="time in timeOptions" :key="time" :value="time">{{ time }}</option>
                                </select>
                            </div>

                            <!-- Input tugas aktivitas -->
                            <div class="col-6">
                                <input v-model="newActivity" class="form-control" placeholder="New Activity">
                            </div>

                            <!-- Tombol tambahkan -->
                            <div class="col-2">
                                <button @click="addTodoList" class="btn btn-primary form-control" :disabled="!canAdd">Add</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Daftar aktivitas -->
                <div class="row justify-content-center">
                    <div class="col-7 mt-5">
                        <h4 class="text-center">Daftar Tugas :</h4>

                        <transition-group name="fade" tag="div">
                            <div v-for="(isiData, id) in currentUser.todos" :key="id" class="p-3 d-flex align-items-center justify-content-between">
                                <div>
                                    <strong>{{ id + 1 }}. </strong> <!-- Nomor urut -->
                                    <span :class="{ 'text-decoration-line-through': isiData.done }">
                                      {{ isiData.text }} | {{ isiData.start }} - {{ isiData.end }} 
                                    </span>
                                </div>

                                <div>
                                    <!-- Tombol Selesai (Done) -->
                                    <button class="btn btn-success me-2" @click="toggleDone(id)">
                                        {{ isiData.done ? "Selesai" : "Done" }}
                                    </button>

                                    <!-- Tombol Edit -->
                                    <button class="btn btn-warning me-2" @click="editTodoList(id)">Edit</button>

                                    <!-- Tombol Hapus -->
                                    <button class="btn btn-outline-danger" @click="confirmDelete(id)">Delete</button>
                                </div>
                            </div>
                        </transition-group>
                    </div>
                </div>

                <!-- Tombol Logout -->
                <div class="text-center mt-5">
                    <button @click="logout" class="btn btn-danger">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    // State untuk halaman login atau register
                    currentPage: 'login',
                    isLoggedIn: false,

                    // Data untuk login
                    loginUsername: '',
                    loginId: '',

                    // Data untuk register
                    registerUsername: '',
                    registerId: '',

                    // Data aktivitas pengguna
                    startTime: '',
                    endTime: '',
                    newActivity: '',

                    // Opsi waktu
                    timeOptions: [
                        "12:00 AM", "01:00 AM", "02:00 AM", "03:00 AM", "04:00 AM", "05:00 AM", "06:00 AM", "07:00 AM",
                        "08:00 AM", "09:00 AM", "10:00 AM", "11:00 AM", "12:00 PM", "01:00 PM", "02:00 PM", "03:00 PM",
                        "04:00 PM", "05:00 PM", "06:00 PM", "07:00 PM", "08:00 PM", "09:00 PM", "10:00 PM", "11:00 PM"
                    ],

                    // Data pengguna yang sedang login
                    currentUser: null,

                    // Variabel untuk mengedit
                    editIndex: null
                };
            },
            computed: {
                // Validasi input apakah bisa menambah aktivitas
                canAdd() {
                    return this.startTime && this.endTime && this.newActivity;
                }
            },
            methods: {
                // Fungsi untuk berpindah halaman login/register
                switchPage(page) {
                    this.currentPage = page;
                },

                // Fungsi untuk register (buat akun)
                register() {
                    if (this.registerUsername && this.registerId.toString().length >= 5) {
                        let users = JSON.parse(localStorage.getItem('users')) || [];
                        let userExists = users.find(user => user.username === this.registerUsername);

                        if (userExists) {
                            // Menambahkan tiga angka acak jika nama sudah dipakai
                            let randomNumber = Math.floor(Math.random() * 900) + 100; // Generate angka dari 100 hingga 999
                            this.registerUsername = this.registerUsername + randomNumber;
                        }

                        users.push({
                            username: this.registerUsername,
                            id: this.registerId,
                            todos: []
                        });
                        localStorage.setItem('users', JSON.stringify(users));
                        Swal.fire('Sukses', 'Akun berhasil dibuat!', 'success');
                        this.switchPage('login');
                    } else {
                        Swal.fire('Error', 'Username atau ID kurang dari 5 digit!', 'error');
                    }
                },

                // Fungsi untuk login
                login() {
                    if (this.loginId.toString().length >= 5) {
                        const users = JSON.parse(localStorage.getItem('users')) || [];
                        const user = users.find(u => u.username === this.loginUsername && u.id === this.loginId);

                        if (user) {
                            this.isLoggedIn = true;
                            this.currentUser = user;
                        } else {
                            Swal.fire('Error', 'Username atau ID salah!', 'error');
                        }
                    } else {
                        Swal.fire('Error', 'ID harus lebih dari 5 digit!', 'error');
                    }
                },

                // Fungsi untuk menambah todo
                addTodoList() {
                    if (this.canAdd) {
                        const newTodo = {
                            text: this.newActivity,
                            start: this.startTime,
                            end: this.endTime,
                            done: false
                        };
                        this.currentUser.todos.push(newTodo);
                        this.saveCurrentUser();
                        this.startTime = this.endTime = this.newActivity = '';
                    }
                },

                // Fungsi untuk menghapus todo dengan konfirmasi
                confirmDelete(id) {
                    Swal.fire({
                        title: 'Yakin ingin menghapus?',
                        text: "Data ini akan dihapus secara permanen!",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#3085d6',
                        confirmButtonText: 'Ya, hapus!',
                        cancelButtonText: 'Batal'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            this.deleteTodoList(id);
                            Swal.fire(
                                'Terhapus!',
                                'Aktivitas telah berhasil dihapus.',
                                'success'
                            );
                        }
                    });
                },

                // Fungsi untuk menghapus todo
                deleteTodoList(id) {
                    this.currentUser.todos.splice(id, 1);
                    this.saveCurrentUser();
                },

                // Fungsi untuk menandai selesai atau belum
                toggleDone(id) {
                    this.currentUser.todos[id].done = !this.currentUser.todos[id].done;
                    this.saveCurrentUser();
                },

                // Fungsi untuk mengedit todo
                editTodoList(id) {
                    const item = this.currentUser.todos[id];
                    Swal.fire({
                        title: 'Edit Aktivitas',
                        html: `<input type="text" id="swal-input1" class="swal2-input" value="${item.start}">
                               <input type="text" id="swal-input2" class="swal2-input" value="${item.end}">
                               <input type="text" id="swal-input3" class="swal2-input" value="${item.text}">`,
                        focusConfirm: false,
                        showCancelButton: true,
                        confirmButtonText: 'Simpan',
                        cancelButtonText: 'Batal',
                        preConfirm: () => {
                            const start = document.getElementById('swal-input1').value;
                            const end = document.getElementById('swal-input2').value;
                            const text = document.getElementById('swal-input3').value;
                            return { start, end, text }
                        }
                    }).then((result) => {
                        if (result.isConfirmed && result.value) {
                            this.currentUser.todos[id].start = result.value.start;
                            this.currentUser.todos[id].end = result.value.end;
                            this.currentUser.todos[id].text = result.value.text;
                            this.saveCurrentUser();
                            Swal.fire('Sukses!', 'Aktivitas berhasil diperbarui.', 'success');
                        }
                    });
                },

                // Fungsi untuk menyimpan data pengguna ke LocalStorage
                saveCurrentUser() {
                    const users = JSON.parse(localStorage.getItem('users')) || [];
                    const userIndex = users.findIndex(u => u.username === this.currentUser.username && u.id === this.currentUser.id);
                    if (userIndex !== -1) {
                        users[userIndex] = this.currentUser;
                        localStorage.setItem('users', JSON.stringify(users));
                    }
                },

                // Fungsi untuk logout
                logout() {
                    this.isLoggedIn = false;
                    this.currentUser = null;
                    this.loginUsername = '';
                    this.loginId = '';
                }
            },
            mounted() {
                // Mengambil data dari LocalStorage jika pengguna sudah pernah login
                const savedUser = JSON.parse(localStorage.getItem('currentUser'));
                if (savedUser) {
                    this.isLoggedIn = true;
                    this.currentUser = savedUser;
                }
            },
            watch: {
                // Menyimpan data pengguna yang sedang login ke LocalStorage
                currentUser(newUser) {
                    if (newUser) {
                        localStorage.setItem('currentUser', JSON.stringify(newUser));
                    } else {
                        localStorage.removeItem('currentUser');
                    }
                }
            }
        });

        app.mount("#app");
    </script>
<footer>
    By Satri Chanra
</footer>
    <!-- Bootstrap JS untuk modal -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>